plugins {
    id 'java-library'
    id "groovy"
    id "com.jfrog.artifactory" version "4.29.1"
    id 'maven-publish'
}

group 'dev.inaka'
version '1.0.0'

dependencies {
    implementation 'org.apache.httpcomponents:httpclient:4.5.13'
    implementation 'org.apache.httpcomponents:httpmime:4.5.13'
    implementation 'commons-io:commons-io:2.11.0'
    testImplementation 'net.bytebuddy:byte-buddy:1.12.16'
    testImplementation 'org.objenesis:objenesis:3.2'
    testImplementation 'org.codehaus.groovy:groovy-all:3.0.13'
    testImplementation 'org.spockframework:spock-core:2.3-groovy-3.0'
}

test {
    useJUnitPlatform()
}

task fatJar(type: Jar) {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    archiveBaseName = "${rootProject.name}"
    from { configurations.compileClasspath.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar
}

publishing {
    publications {
        maven(MavenPublication) {
            groupId = 'div.inaka.jotenberg'
            artifactId = 'jotenberg'
            version = '1.0.0'
            from components.java
        }
    }
}

repositories {
    mavenCentral()
    maven {
        name = "Artifactory"
        url "https://inaka.jfrog.io/artifactory/inaka-gradle-release/"
    }
    maven {
        name = "GitHubPackages"
        url = "https://maven.pkg.github.com/cherfia/jotenberg"
        credentials {
            username = System.getenv("GITHUB_ACTOR")
            password = System.getenv("GITHUB_TOKEN")
        }
    }
}

artifactory {
    contextUrl = "${artifactory_contextUrl}"
    publish {
        repository {
            repoKey = 'inaka-gradle-release-local'
            username = "${artifactory_user}"
            password = "${artifactory_password}"
            maven = true
        }
        defaults {
            publications('mavenJava')
            publishConfigs('archives', 'published')
            properties = ['qa.level': 'basic', 'q.os': 'win32, deb, osx']
        }
    }
    resolve {
        repository {
            repoKey = 'inaka-gradle-release'
            username = "${artifactory_user}"
            password = "${artifactory_password}"
            maven = true

        }
    }
}